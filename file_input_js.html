<script>
document.addEventListener('DOMContentLoaded', () => {
  const fileInput   = document.getElementById('uploadPhotos');
  const previewArea = document.getElementById('previewArea');
  const fileCountEl = document.getElementById('fileCount');

  if (!fileInput || !previewArea || !fileCountEl) {
    console.warn('upload UI elements not found');
    return;
  }

  fileInput.addEventListener('change', () => {
    const files = Array.from(fileInput.files);
    if (files.length > 5) alert('写真は最大5枚までです。先頭5枚のみ表示します。');
    const limited = files.slice(0, 5);

    fileCountEl.textContent = `${limited.length} 枚`;
    previewArea.innerHTML = '';

    // 名前順で並び替え
    files.sort((a, b) => a.name.localeCompare(b.name));


    limited.forEach((file, idx) => {
      if (!file.type.startsWith('image/')) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        const card  = document.createElement('div');
        const img   = document.createElement('img');
        const badge = document.createElement('div');
        card.className = 'preview-card';
        img.src = e.target.result;
        img.alt = `アップロード画像 ${idx + 1}枚目`;
        badge.className = 'preview-badge';
        badge.textContent = `${idx + 1} 枚目`;
        card.append(img, badge);
        previewArea.appendChild(card);
      };
      reader.readAsDataURL(file);
    });
  });
});
</script>
