<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">

  <!-- 各ファイル 読み込み -->
  <?!= include('style'); ?>
  <?!= include('file_input_js'); ?>
  <?!= include('form_js'); ?>
  <?!= include('send_js'); ?>
  <?!= include('history_view_js'); ?>
  <?!= include('check_js'); ?>

  <!-- 最後に読み込む必要がある→実行してしまうから -->
  <?!= include('init_js'); ?>


</head>

<body>
  <div id="dateToggleWrapper">
    <label class="date-toggle-button" id="dateToggleButton">
      <input type="checkbox" id="customDateToggle" onchange="toggleDateInput(this)">
      ※当日より前の出面入力の場合はこちらをタップ
    </label>
    <div id="dateContainer">
      <label for="customDate" class="section-label">出面日付</label>
      <input type="date" id="customDate">
      <div id="error-date" class="error-message"></div>
    </div>
  </div>


  <div>
    <label for="company" class="section-label">元請会社</label>
    <select id="company">
      <option value="" disabled selected>選択してください</option>
    </select>
    <div id="error-company" class="error-message"></div>
  </div>


  <div>
    <label for="staff" class="section-label">TTC担当者</label>
    <select id="staff">
      <option value="" disabled selected>選択してください</option>
    </select>
    <div id="error-staff" class="error-message"></div>
  </div>


  <div>
    <label for="site" class="section-label">現場名</label>
    <select id="site">
      <option value="" disabled selected>選択してください</option>
    </select>
    <div id="error-site" class="error-message"></div>
  </div>

  <!-- ✅ モーダル表示トリガー -->
  <div style="margin-top: 2rem;">
    <label class="date-toggle-button" onclick="openHistoryModal()">
      ※送信履歴を確認したい場合はこちらをタップ
    </label>
  </div>

  <!-- ✅ 履歴モーダル本体 -->
  <div id="historyModal"
    style="display: none; position: fixed; z-index: 9999; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
    <div
      style="background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <h3>何日の送信履歴を確認しますか？</h3>
      <input type="date" id="modalHistoryDate" class="custom-date-input" />
      <button onclick="loadModalHistory()">送信履歴を取得</button>
      <div id="modalHistoryContent" style="margin-top: 1rem;"></div>
      <!-- ✅ 新規追加フォーム（モーダル下部に追加） -->
      <div class="toggle-header" onclick="toggleSection('toggleAddArea')">＋ 新しい作業者／協力会社を追加</div>
      <div id="toggleAddArea" class="toggle-section">
        <div class="toggle-header inner" onclick="toggleSection('workerSection')">▶ 作業者</div>
        <div id="workerSection" class="toggle-section inner">
          <div id="additionalWorkerInputs"></div>
        </div>

        <div class="toggle-header inner" onclick="toggleSection('partnerSection')">▶ 協力会社</div>
        <div id="partnerSection" class="toggle-section inner">
          <div id="additionalPartnerInputs"></div>
        </div>
      </div>
<!-- モーダル用 -->
<div id="uploaderModal" class="upload-section">
  <input type="file" accept="image/*" multiple hidden>
  <label class="file-button">ファイル選択 <span class="file-count">0 枚</span></label>
  <div class="preview-grid"></div>
</div>

        <!-- プレビュー -->
        <div id="previewArea" class="preview-grid" aria-live="polite"></div>
      </div>

      <button onclick="closeHistoryModal()" style="margin-top: 1rem;">閉じる</button>
    </div>
  </div>

  <!--
  <div>
  <label class="section-label">送信履歴</label>
  <div id="historyRecords" style="margin-top: 1rem; border: 1px solid #ccc; padding: 1rem;  border-radius: 6px; background-color: #fff;"></div>
  </div>

<div style="margin-bottom: 1rem;">
  <label for="historyDate">履歴対象日付</label>
  <input type="date" id="historyDate" style="font-size: 2rem; padding: 0.5rem; width: 100%;">
</div>

<div id="editSection" style="margin-top: 2rem;">
  <button id="editButton" onclick="showEditForm()" style="display: none;">編集する</button>
  <div id="editFormContainer"></div>
</div>
-->

  <div>
    <label class="section-label">作業者</label>
    <div id="worker" class="checkbox-group"></div>
    <div id="error-worker" class="error-message"></div>
  </div>


  <div>
    <label class="section-label">協力会社名</label>
    <div id="partner" class="checkbox-group"></div>
    <div id="error-partner" class="error-message"></div>
  </div>



<!-- 本体用 -->
<div id="uploaderMain" class="upload-section">
  <input type="file" accept="image/*" multiple hidden>
  <label class="file-button">ファイル選択 <span class="file-count">0 枚</span></label>
  <div class="preview-grid"></div>
</div>


  <!-- <script>
    const fileInput = document.getElementById('uploadPhotos');
    const previewArea = document.getElementById('previewArea');

    fileInput.addEventListener('change', () => {
      previewArea.innerHTML = ''; // 一度クリア
      const files = Array.from(fileInput.files).slice(0, 5); // 最大5枚まで

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.maxWidth = '150px';
          img.style.maxHeight = '150px';
          img.style.objectFit = 'cover';
          img.style.border = '1px solid #ccc';
          img.style.borderRadius = '6px';
          previewArea.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });
  </script> -->


  <div>
    <button onclick="submitForm()">送信</button>
  </div>


  <!-- 確認モーダル -->
  <div id="confirmationModal" onclick="handleModalClickOutside(event)">
    <div id="confirmationBox" onclick="event.stopPropagation()">
      <div id="confirmationText">この内容で送信しますか？</div>
      <div class="button-row">
        <button onclick="confirmSend()">✅ 確定して送信</button>
        <button onclick="closeConfirmation()">戻る</button>
      </div>
    </div>
  </div>


  <!-- ローディングオーバーレイ（統合版） -->
  <div id="loadingOverlay">
    <div class="loader"></div>
    <div style="margin-top: 1rem; font-size: 1.2rem; color: #0066cc;">送信中...</div>
  </div>






</body>




</html>
