<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/heic2any/dist/heic2any.min.js"></script>

  <!-- 各ファイル 読み込み -->
  <!-- <?!= include('style'); ?> -->
  <?!= include('wait_js'); ?> <!-- ローディングオーバーレイ -->
  <?!= include('check_js'); ?> <!-- sanitize / isValidQuarterHour など -->
  <?!= include('file_input_js'); ?> <!-- アップローダ -->
  <?!= include('form_js'); ?> <!-- 画面組立て / submitForm 定義 -->
  <?!= include('send_js'); ?> <!-- 送信・モーダル表示など -->
  <?!= include('history_view_js'); ?>
  <?!= include('init_js'); ?> <!-- 最後：イベント配線など -->

</head>

<body>
  <!-- JS は最後にまとめて -->


  <div id="dateToggleWrapper">
    <label class="date-toggle-button" id="dateToggleButton">
      <input type="checkbox" id="customDateToggle" onchange="toggleDateInput(this)">
      ※当日より前の出面入力の場合はこちらをタップ
    </label>
    <div id="dateContainer">
      <label for="customDate" class="section-label">出面日付</label>
      <input type="date" id="customDate">
      <div id="error-date" class="error-message"></div>
    </div>
  </div>


  <div>
    <label for="company" class="section-label">元請会社</label>
    <select id="company">
      <option value="" disabled selected>選択してください</option>
    </select>
    <div id="error-company" class="error-message"></div>
  </div>


  <div>
    <label for="staff" class="section-label">TTC担当者</label>
    <select id="staff">
      <option value="" disabled selected>選択してください</option>
    </select>
    <div id="error-staff" class="error-message"></div>
  </div>


  <div>
    <label for="site" class="section-label">現場名</label>
    <select id="site">
      <option value="" disabled selected>選択してください</option>
    </select>
    <div id="error-site" class="error-message"></div>
  </div>

  <!-- ✅ トリガー -->
  <div style="margin-top: 2rem;">
    <label class="date-toggle-button" onclick="openHistoryModal()">
      ※送信履歴を確認したい場合はこちらをタップ
    </label>
  </div>

  <!-- ✅ モーダル本体（inline style は不要。display は CSS で管理） -->
  <div id="historyModal">
    <div class="modal-body">
      <h3>何日の送信履歴を確認しますか？</h3>
      <input type="date" id="modalHistoryDate" class="custom-date-input" />
      <button onclick="loadModalHistory()">送信履歴を取得</button>
      <div id="modalHistoryContent" style="margin-top: 1rem;"></div>

      <button onclick="closeHistoryModal()" style="margin-top: 1rem;">閉じる</button>
    </div>
  </div>


  <div>
    <label class="section-label">作業者</label>
    <div id="worker" class="checkbox-group"></div>
    <div id="error-worker" class="error-message"></div>
  </div>


  <div>
    <label class="section-label">協力会社名</label>
    <div id="partner" class="checkbox-group"></div>
    <div id="error-partner" class="error-message"></div>
  </div>



  <!-- main 画像アップロード -->
  <div id="uploaderMain" class="upload-section">
    <input type="file" accept="image/*" multiple hidden>
    <label class="file-button">ファイル選択 <span class="file-count">0 枚</span></label>
    <div class="preview-grid"></div>
  </div>

  <!-- mainでの送信ボタン -->
  <div>
    <button id="sendBtn" type="button">送信</button>
  </div>


  <!-- 確認モーダル -->
  <div id="confirmationModal" onclick="handleModalClickOutside(event)">
    <div id="confirmationBox" onclick="event.stopPropagation()">
      <div id="confirmationText">この内容で送信しますか？</div>
      <div class="button-row">
        <button onclick="confirmSend()">✅ 確定して送信</button>
        <button onclick="closeConfirmation()">戻る</button>
      </div>
    </div>
  </div>


  <!-- ローディングオーバーレイ（統合版） -->
  <div id="loadingOverlay">
    <div class="loader"></div>
    <div style="margin-top: 1rem; font-size: 1.2rem; color: #0066cc;">送信中...</div>
  </div>

</body>

</html>
