<script>
  const ROLE = window.ROLE || { GENERAL: 'general', LEADER: 'leader', QUALIFIED: 'qualified' };
  window.ROLE = ROLE;
  window.lastFetchedRecords = window.lastFetchedRecords || [];

  // ------------------------------------------
  // é€ä¿¡å±¥æ­´ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãï¼ˆåˆå›ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ï¼‰
  // æ—¥ä»˜ï¼‹é€ä¿¡å±¥æ­´ã‚’å–å¾—
  // ------------------------------------------

  function openHistoryModal() {
    console.log('[openHistoryModal] é–‹å§‹'); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
    document.getElementById('modalHistoryDate').value = new Date().toISOString().split("T")[0];
    document.getElementById('modalHistoryContent').innerHTML = '';
    document.getElementById('historyModal').style.display = 'flex';
    console.log('[openHistoryModal] çµ‚äº†', { modalDate: document.getElementById('modalHistoryDate')?.value }); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  }



  // ------------------------------------------
  // closeHistoryModal: å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  // ------------------------------------------
  function closeHistoryModal() {
    console.log('[closeHistoryModal] é–‹å§‹'); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
    document.getElementById('historyModal').style.display = 'none';
    console.log('[closeHistoryModal] çµ‚äº†'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  }



  // ------------------------------------------
  // displayHistory: å–å¾—ã—ãŸå±¥æ­´ã‚’ç”»é¢ã®ä¸€è¦§ã«æç”»ã™ã‚‹
  // ------------------------------------------
  function displayHistory(records) {
    console.log('[displayHistory] é–‹å§‹', { recordCount: records?.length || 0 }); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
    const container = document.getElementById('historyRecords');
    const editButton = document.getElementById('editButton');
    window.lastFetchedRecords = records;

    if (!records || records.length === 0) {
      container.innerHTML = '<em>å±¥æ­´ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</em>';
      editButton.style.display = 'none';
      console.log('[displayHistory] çµ‚äº† (è©²å½“ãƒ‡ãƒ¼ã‚¿ãªã—)'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
      return;
    }

    let html = '<table style="width:100%; border-collapse: collapse;">';
    html += '<tr><th>ç¨®åˆ¥</th><th>åå‰</th><th>äººå·¥</th><th>æ®‹æ¥­</th></tr>';
    records.forEach(r => {
      html += `<tr>
      <td>${r.type}</td>
      <td>${r.name}</td>
      <td>${r.man}</td>
      <td>${r.overtime}</td>
    </tr>`;
    });
    html += '</table>';
    container.innerHTML = html;

    editButton.style.display = 'inline-block'; // ç·¨é›†ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    console.log('[displayHistory] çµ‚äº†', { è¡¨ç¤ºä»¶æ•°: records.length }); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  }




  // ------------------------------------------
  // loadPreviousRecords: æ¡ä»¶ã«åˆã†å±¥æ­´ã‚’ä¸€è¦§é ˜åŸŸã¸å†æç”»ã™ã‚‹
  // ------------------------------------------
  function loadPreviousRecords() {
    console.log('[loadPreviousRecords] é–‹å§‹', {
      date: document.getElementById('historyDate')?.value,
      companyId: document.getElementById('company')?.value,
      staffId: document.getElementById('staff')?.value,
      siteId: document.getElementById('site')?.value
    }); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
    const date = document.getElementById('historyDate').value;
    const companyId = document.getElementById('company').value;
    const staffId = document.getElementById('staff').value;
    const siteId = document.getElementById('site').value;

    const container = document.getElementById('historyRecords');

    if (date && companyId && staffId && siteId) {
      // âœ… å³ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤ºï¼ˆèª­ã¿è¾¼ã¿ä¸­ï¼‰
      container.innerHTML = '<em style="color: gray;">ğŸ“‚ é€ä¿¡å±¥æ­´ã‚’å–å¾—ä¸­ã§ã™...</em>';

      // éåŒæœŸå‘¼ã³å‡ºã—
      google.script.run.withSuccessHandler(displayHistory).getPreviousRecords(date, companyId, staffId, siteId);
    } else {
      container.innerHTML = '<em style="color: gray;">â€»é€ä¿¡å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯å±¥æ­´å¯¾è±¡æ—¥ä»˜ãƒ»å…ƒè«‹ãƒ»æ‹…å½“è€…ãƒ»ç¾å ´ã‚’ã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚</em>';
    }
    console.log('[loadPreviousRecords] çµ‚äº†'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  }



  // ------------------------------------------
  // loadModalHistory: ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã«æ¡ä»¶ä¸€è‡´ã®å±¥æ­´ã¨ç·¨é›†ãƒœã‚¿ãƒ³ã‚’æç”»ã™ã‚‹
  // ------------------------------------------
  function loadModalHistory() {
    console.log('[loadModalHistory] é–‹å§‹', {
      date: document.getElementById('modalHistoryDate')?.value,
      companyId: document.getElementById('company')?.value,
      staffId: document.getElementById('staff')?.value,
      siteId: document.getElementById('site')?.value
    }); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
    const date = document.getElementById('modalHistoryDate').value;
    const companyId = document.getElementById('company').value;
    const staffId = document.getElementById('staff').value;
    const siteId = document.getElementById('site').value;
    const container = document.getElementById('modalHistoryContent');

    if (!date || !companyId || !staffId || !siteId) {
      container.innerHTML = '<em style="color:red;">ã™ã¹ã¦ã®é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆå…ƒè«‹ãƒ»æ‹…å½“ãƒ»ç¾å ´ãƒ»æ—¥ä»˜ï¼‰</em>';
      return;
    }

    document.getElementById('loadingOverlay').style.display = 'flex'; // âœ… è¡¨ç¤ºON
    container.innerHTML = ''; // å†…å®¹åˆæœŸåŒ–

    google.script.run.withSuccessHandler(records => {
      console.log("ğŸ“¥ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã£ã¦ããŸå€¤:", records);
      document.getElementById('loadingOverlay').style.display = 'none'; // âœ… è¡¨ç¤ºOFF
      window.lastFetchedRecords = records;
      if (records.length === 0) {
        container.innerHTML = '<em>å±¥æ­´ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</em>';
        console.log('[loadModalHistory] çµ‚äº† (è©²å½“ãƒ‡ãƒ¼ã‚¿ãªã—)'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
        return;
      }

      let html = '<table style="width:100%; border-collapse: collapse;">';
      html += '<tr><th>ç¨®åˆ¥</th><th>åå‰</th><th>äººå·¥</th><th>æ®‹æ¥­</th></tr>';
      records.forEach(r => {
        html += `<tr>
        <td>${r.type}</td>
        <td>${r.name}</td>
        <td>${r.man}</td>
        <td>${r.overtime}</td>
      </tr>`;
      });
      html += '</table>';
      html += `<button onclick="showEditFormInModal()">ç·¨é›†ã™ã‚‹</button>`;
      container.innerHTML = html;
      console.log('[loadModalHistory] çµ‚äº†', { è¡¨ç¤ºä»¶æ•°: records.length }); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
    }).getPreviousRecords(date, companyId, staffId, siteId);
  }



  // ------------------------------------------
  // showEditFormInModal: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ æ§‹æˆã¸åˆ‡ã‚Šæ›¿ãˆã‚‹
  // ------------------------------------------

  // function showEditFormInModal() {
  //   console.log('[showEditFormInModal] é–‹å§‹', { æ—¢å­˜ä»¶æ•°: (window.lastFetchedRecords || []).length }); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
  //   const container = document.getElementById('modalHistoryContent');

  //   let html = '<h3>ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ </h3>';

  //   // å½¹å‰²åˆ—ã‚’å‰Šé™¤ â†’ <th> ã‹ã‚‰ã‚‚å¤–ã™
  //   html += '<table id="edit-table" style="width:100%; border-collapse: collapse;">';
  //   html += '<thead><tr><th>ç¨®åˆ¥</th><th>åå‰</th><th>äººå·¥</th><th>æ®‹æ¥­</th></tr></thead>';
  //   html += '<tbody id="edit-tbody">';

  //   (window.lastFetchedRecords || []).forEach((r, i) => {
  //     const safe = sanitize(r.name);

  //     html += `<tr>
  //     <td>${r.type}</td>
  //     <td>${r.name}</td>

  //     <!-- å½¹å‰²ã¯å‰Šé™¤ã—ã¦ã€äººå·¥ã¨æ®‹æ¥­ã ã‘ -->
  //     <td><input type="number" step="0.25" class="work-input" placeholder="äººå·¥" value="${r.man}" id="edit-man-${i}" /></td>
  //     <td><input type="number" step="0.25" class="work-input" placeholder="æ®‹æ¥­" value="${r.overtime}" id="edit-overtime-${i}" /></td>
  //   </tr>`;
  //   });

  //   html += '</tbody></table>';
  //   html += `
  //   <div id="editUploader" class="upload-section" style="margin:12px 0;"></div>

  //   <h4 style="margin-top:16px;">è¿½åŠ å…¥åŠ›ï¼ˆä½œæ¥­è€…ï¼‰</h4>
  //   <div id="additionalWorkerInputs"></div>

  //   <h4 style="margin-top:16px;">è¿½åŠ å…¥åŠ›ï¼ˆå”åŠ›ä¼šç¤¾ï¼‰</h4>
  //   <div id="additionalPartnerInputs"></div>

  //   <div style="margin-top:16px;">
  //     <button onclick="showEditConfirmationModal()">å†é€ä¿¡ï¼ˆæ›´æ–°ï¼‰</button>
  //   </div>
  // `;

  //   container.innerHTML = html;
  //   renderEditUploader();
  //   // renderAdditionalInputs();
  //   console.log('[showEditFormInModal] çµ‚äº†'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  // }


  function showEditFormInModal() {
    console.log('[showEditFormInModal] é–‹å§‹', { æ—¢å­˜ä»¶æ•°: (window.lastFetchedRecords || []).length });
    const container = document.getElementById('modalHistoryContent');

    let html = '<h3>ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ </h3>';

    html += `
  <table id="edit-table" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr><th>ç¨®åˆ¥</th><th>åå‰</th><th>äººå·¥</th><th>æ®‹æ¥­</th></tr>
    </thead>
    <tbody id="edit-tbody">
  `;

    (window.lastFetchedRecords || []).forEach((r, i) => {
      html += `
      <tr>
        <td>${r.type}</td>
        <td>${r.name}</td>
        <td><input type="number" step="0.25" class="work-input" placeholder="äººå·¥" value="${r.man}" id="edit-man-${i}" /></td>
        <td><input type="number" step="0.25" class="work-input" placeholder="æ®‹æ¥­" value="${r.overtime}" id="edit-overtime-${i}" /></td>
      </tr>`;
    });

    html += `
    </tbody>
  </table>

  <div id="editUploader" class="upload-section" style="margin:12px 0;"></div>

  <!-- âœ… ã“ã“ã« toggle ãƒ–ãƒ­ãƒƒã‚¯ã‚’åŸ‹ã‚è¾¼ã‚€ -->
  <div class="toggle-header" onclick="toggleSection('toggleAddArea')">
    ï¼‹ æ–°ã—ã„ä½œæ¥­è€…ï¼å”åŠ›ä¼šç¤¾ã‚’è¿½åŠ 
  </div>

  <div id="toggleAddArea" class="toggle-section">
    <!-- ä½œæ¥­è€… -->
    <div class="toggle-header inner" onclick="handleToggleWorkerSection()">â–¶ ä½œæ¥­è€…</div>
    <div id="workerSection" class="toggle-section inner">
      <div id="additionalWorkerInputs"></div>
    </div>

    <!-- å”åŠ›ä¼šç¤¾ -->
    <div class="toggle-header inner" onclick="handleTogglePartnerSection()">â–¶ å”åŠ›ä¼šç¤¾</div>
    <div id="partnerSection" class="toggle-section inner">
      <div id="additionalPartnerInputs"></div>
    </div>
  </div>

  <div style="margin-top:16px;">
    <button onclick="showEditConfirmationModal()">å†é€ä¿¡ï¼ˆæ›´æ–°ï¼‰</button>
  </div>
  `;

    container.innerHTML = html;
    renderEditUploader(); // â† ã“ã‚Œã¯å…ˆã«OK
    console.log('[showEditFormInModal] çµ‚äº†');
  }

  // ------------------------------------------
  // ç·¨é›†ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚ã¨ã«ã€ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UIã‚’æç”»
  // ------------------------------------------



  // ------------------------------------------
  // renderEditUploader: ç·¨é›†ç”¨ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UIã‚’æç”»ã™ã‚‹
  // ------------------------------------------
  function renderEditUploader() {
    console.log('[renderEditUploader] é–‹å§‹'); // å‡¦ç†é–‹å§‹ãƒ­ã‚°
    const container = document.getElementById('editUploader');
    if (!container) return;

    container.innerHTML = `
      <div id="uploaderEdit" class="uploader">
        <input type="file" accept="image/*" multiple hidden>
        <label class="file-button">ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ <span class="file-count">0 æš</span></label>
        <div class="preview-grid"></div>
      </div>
    `;

    // æ—¢å­˜ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼åˆæœŸåŒ–ã‚’ä½¿ã†
    setupUploader('uploaderEdit', { max: 5, mode: 'carousel', queueKey: 'edit' });
    console.log('[renderEditUploader] çµ‚äº†'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  }

  // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ï¼šå”åŠ›ä¼šç¤¾ã®ã€Œå½¹å‰²ã€ã‚’ç¸¦ä¸¦ã³ãƒ©ã‚¸ã‚ªã§ä½œã‚‹



  // ------------------------------------------
  // createEditPartnerRoleBlock: ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®å½¹å‰²é¸æŠUIã‚’ä½œæˆã™ã‚‹
  // ------------------------------------------
  function createEditPartnerRoleBlock(nameKey) {
    // ä¾‹: nameKey = "modal-partner-ABC"
    const wrap = document.createElement('div');
    wrap.className = 'partner-role-wrap';
    wrap.id = `role-${nameKey}`;
    wrap.style.display = 'none'; // ãƒã‚§ãƒƒã‚¯ONã§ã ã‘è¡¨ç¤º

    const radioName = `${nameKey}-role`; // â† submitå´ã®å‚ç…§ã¨ä¸€è‡´ã•ã›ã‚‹

    wrap.innerHTML = `
    <div class="partner-role-grid partner-role-grid--col">
      <label class="role-card">
        <input type="radio" name="${radioName}" value="only">
        <span>ä¸€èˆ¬ä½œæ¥­å“¡</span>
      </label>
      <label class="role-card">
        <input type="radio" name="${radioName}" value="leader">
        <span>è·é•·</span>
      </label>
      <label class="role-card">
        <input type="radio" name="${radioName}" value="other">
        <span>æœ‰è³‡æ ¼è€…</span>
      </label>
    </div>
  `;
    return wrap;
  }



  // ------------------------------------------
  // renderAdditionalInputs: è¿½åŠ å…¥åŠ›ç”¨ã®ä½œæ¥­è€…ãƒ»å”åŠ›ä¼šç¤¾ãƒªã‚¹ãƒˆã‚’æç”»ã™ã‚‹
  // ------------------------------------------
  // function renderAdditionalInputs() {
  //   console.group('ğŸ§© è¿½åŠ å…¥åŠ›ã®æç”»');

  //   const workerContainer = document.getElementById('additionalWorkerInputs');
  //   const partnerContainer = document.getElementById('additionalPartnerInputs');
  //   workerContainer.innerHTML = '';
  //   partnerContainer.innerHTML = '';

  //   const staffId = document.getElementById('staff').value;
  //   console.log('é¸æŠä¸­ã®ã‚¹ã‚¿ãƒƒãƒ•ID:', staffId); // ğŸ“ LOG
  //   if (!staffId) {
  //     console.warn('âš  ã‚¹ã‚¿ãƒƒãƒ•IDãŒæœªé¸æŠã®ãŸã‚ã€è¿½åŠ å€™è£œã¯è¡¨ç¤ºã—ã¾ã›ã‚“ã€‚'); // ğŸ“ LOG
  //     console.groupEnd();
  //     return;
  //   }

  //   const registered = new Set((window.lastFetchedRecords || []).map(r => `${r.type}:${r.name}`));
  //   console.log('å½“æ—¥å…¥åŠ›æ¸ˆã¿ï¼ˆåˆæœŸï¼‰ã®é™¤å¤–ã‚­ãƒ¼æ•°:', registered.size); // ğŸ“ LOG

  //   // ğŸ”½ ç·¨é›†ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ä½œæ¥­è€…ï¼å”åŠ›ä¼šç¤¾ã®åå‰ã‚‚é™¤å¤–å¯¾è±¡ã«è¿½åŠ 
  //   document.querySelectorAll('#edit-table tbody tr').forEach(row => {
  //     const type = row.querySelector('td:nth-child(1)').textContent.trim();
  //     const name = row.querySelector('td:nth-child(2)').textContent.trim();
  //     registered.add(`${type}:${name}`);
  //   });
  //   console.log('ç·¨é›†ãƒ†ãƒ¼ãƒ–ãƒ«åæ˜ å¾Œã®é™¤å¤–ã‚­ãƒ¼ç·æ•°:', registered.size); // ğŸ“ LOG

  //   // è¿½åŠ UIï¼šå”åŠ›ä¼šç¤¾ã®ã¨ãã ã‘å½¹å‰²ãƒ©ã‚¸ã‚ªã‚‚å…¥ã‚Œã‚‹
  //   const createCheckboxBlock = (type, name, container) => {
  //     const safeName = sanitize(name);
  //     const key = `modal-${type}-${safeName}`;

  //     // ğŸ“ LOG: å®Ÿéš›ã«æç”»ã™ã‚‹å€™è£œ
  //     console.log(`å€™è£œã‚’æç”»: ç¨®åˆ¥=${type === 'partner' ? 'å”åŠ›ä¼šç¤¾' : 'ä½œæ¥­è€…'} / åç§°=${name} / key=${key}`);

  //     const wrapper = document.createElement('label');
  //     wrapper.className = 'checkbox-wrapper';

  //     const checkbox = document.createElement('input');
  //     checkbox.type = 'checkbox';
  //     checkbox.className = `additional-${type}`;
  //     checkbox.value = name;
  //     checkbox.dataset.key = key;

  //     // ä½œæ¥­è€…ã¯å¾“æ¥ã®æ™‚é–“UIã€å”åŠ›ä¼šç¤¾ã¯ãƒãƒˆãƒªã‚¯ã‚¹UIã‚’ON/OFF
  //     checkbox.onchange = () => {
  //       if (type === 'partner') {
  //         togglePartnerMatrix(checkbox, key);  // â† æ–°ãƒãƒ³ãƒ‰ãƒ©
  //       } else {
  //         toggleTimeInputs(checkbox, key);     // â† æ—¢å­˜ï¼ˆä½œæ¥­è€…ï¼‰
  //       }
  //     };

  //     const span = document.createElement('span');
  //     span.textContent = name;

  //     wrapper.appendChild(checkbox);
  //     wrapper.appendChild(span);
  //     container.appendChild(wrapper);

  //     if (type === 'partner') {
  //       // â˜… æ–°ï¼š3å½¹å‰²Ã—(äººå·¥/æ®‹æ¥­) ã®ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰
  //       const matrix = createPartnerRoleMatrix(key);
  //       matrix.style.display = 'none';
  //       container.appendChild(matrix);
  //     } else {
  //       // ä½œæ¥­è€…ã¯å¾“æ¥ã©ãŠã‚Šäººå·¥/æ®‹æ¥­ã‚’1ã‚»ãƒƒãƒˆ
  //       const inputs = createTimeInputs(key);
  //       container.appendChild(inputs);
  //     }
  //   };

  //   // âœ… ä½œæ¥­è€…
  //   const workersForStaff = masterData.worker
  //     .filter(w => w.staffIds.includes(staffId));
  //   console.log('ä½œæ¥­è€…ãƒã‚¹ã‚¿ï¼ˆã‚¹ã‚¿ãƒƒãƒ•IDã§çµã‚Šè¾¼ã¿å¾Œï¼‰ä»¶æ•°:', workersForStaff.length); // ğŸ“ LOG

  //   const workerRemain = workersForStaff
  //     .filter(w => !registered.has(`ä½œæ¥­è€…:${w.name}`)); // âœ… é‡è¤‡å›é¿
  //   console.log('ä½œæ¥­è€…ï¼šé‡è¤‡é™¤å¤–å¾Œã«è¡¨ç¤ºã™ã‚‹ä»¶æ•°:', workerRemain.length); // ğŸ“ LOG
  //   workerRemain.forEach(w => createCheckboxBlock('worker', w.name, workerContainer));

  //   // âœ… å”åŠ›ä¼šç¤¾
  //   const partnersForStaff = masterData.partner
  //     .filter(p => p.staffIds.includes(staffId));
  //   console.log('å”åŠ›ä¼šç¤¾ãƒã‚¹ã‚¿ï¼ˆã‚¹ã‚¿ãƒƒãƒ•IDã§çµã‚Šè¾¼ã¿å¾Œï¼‰ä»¶æ•°:', partnersForStaff.length);

  //   // ä¼šç¤¾ã”ã¨ã®ä½¿ç”¨æ¸ˆã¿å½¹å‰²ãƒãƒƒãƒ—ã‚’æ§‹ç¯‰
  //   const usedRoleMap = buildUsedPartnerRoleMap();

  //   // ä¼šç¤¾ã”ã¨ã®â€œã¾ã ä½¿ãˆã‚‹å½¹å‰²â€ãŒ1ã¤ã‚‚ãªã‘ã‚Œã°å‡ºã•ãªã„
  //   const partnerRemain = partnersForStaff.filter(p => {
  //     const used = usedRoleMap.get(p.name) || new Set();
  //     return !(used.has(ROLE.GENERAL) && used.has(ROLE.LEADER) && used.has(ROLE.QUALIFIED));
  //   });
  //   console.log('å”åŠ›ä¼šç¤¾ï¼šé‡è¤‡ï¼ˆå½¹å‰²è¾¼ã¿ï¼‰é™¤å¤–å¾Œã«è¡¨ç¤ºã™ã‚‹ä»¶æ•°:', partnerRemain.length);

  //   // æç”»
  //   partnerRemain.forEach(p => {
  //     const safeName = sanitize(p.name);
  //     const key = `modal-partner-${safeName}`;
  //     const wrapper = document.createElement('label');
  //     wrapper.className = 'checkbox-wrapper';

  //     const checkbox = document.createElement('input');
  //     checkbox.type = 'checkbox';
  //     checkbox.className = 'additional-partner';
  //     checkbox.value = p.name;
  //     checkbox.dataset.key = key;
  //     checkbox.onchange = () => togglePartnerMatrix(checkbox, key);

  //     const span = document.createElement('span');
  //     span.textContent = p.name;

  //     wrapper.appendChild(checkbox);
  //     wrapper.appendChild(span);
  //     partnerContainer.appendChild(wrapper);

  //     // ä¼šç¤¾ã”ã¨ã®ä½¿ç”¨æ¸ˆã¿å½¹å‰²ã‚»ãƒƒãƒˆã‚’ãƒãƒˆãƒªã‚¯ã‚¹ã«æ¸¡ã™
  //     const usedRoles = usedRoleMap.get(p.name) || new Set();
  //     const matrix = createPartnerRoleMatrix(key, usedRoles);
  //     matrix.style.display = 'none';
  //     partnerContainer.appendChild(matrix);
  //   });
  //   console.groupEnd();
  // }  // â†â†â† ã“ã“ã§ renderAdditionalInputs ã‚’é–‰ã˜ã‚‹


  function renderAdditionalInputs(targetType) {
    console.group('ğŸ§© è¿½åŠ å…¥åŠ›ã®æç”»');

    const workerContainer = document.getElementById('additionalWorkerInputs');
    const partnerContainer = document.getElementById('additionalPartnerInputs');

    // ç©ºã«ã—ã¦ã‚‚OKã ãŒã€æœ€åˆã¯éè¡¨ç¤ºãªã®ã§çœç•¥ã—ã¦ã‚‚ã‚ˆã„
    if (targetType === 'worker' || !targetType) workerContainer.innerHTML = '';
    if (targetType === 'partner' || !targetType) partnerContainer.innerHTML = '';

    const staffId = document.getElementById('staff').value;
    if (!staffId) {
      console.warn('âš  ã‚¹ã‚¿ãƒƒãƒ•IDãŒæœªé¸æŠã®ãŸã‚ã€è¿½åŠ å€™è£œã¯è¡¨ç¤ºã—ã¾ã›ã‚“ã€‚');
      console.groupEnd();
      return;
    }

    const registered = new Set((window.lastFetchedRecords || []).map(r => `${r.type}:${r.name}`));

    // ğŸ”½ ç·¨é›†ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤ºæ¸ˆã¿ã‚‚é™¤å¤–
    document.querySelectorAll('#edit-table tbody tr').forEach(row => {
      const type = row.querySelector('td:nth-child(1)').textContent.trim();
      const name = row.querySelector('td:nth-child(2)').textContent.trim();
      registered.add(`${type}:${name}`);
    });

    // âœ… ä½œæ¥­è€…ã®æç”»
    if (targetType === 'worker' || !targetType) {
      const workersForStaff = masterData.worker.filter(w => w.staffIds.includes(staffId));
      const workerRemain = workersForStaff.filter(w => !registered.has(`ä½œæ¥­è€…:${w.name}`));
      workerRemain.forEach(w => createCheckboxBlock('worker', w.name, workerContainer));
    }

    // âœ… å”åŠ›ä¼šç¤¾ã®æç”»
    if (targetType === 'partner' || !targetType) {
      const partnersForStaff = masterData.partner.filter(p => p.staffIds.includes(staffId));
      const usedRoleMap = buildUsedPartnerRoleMap();
      const partnerRemain = partnersForStaff.filter(p => {
        const used = usedRoleMap.get(p.name) || new Set();
        return !(used.has(ROLE.GENERAL) && used.has(ROLE.LEADER) && used.has(ROLE.QUALIFIED));
      });
      partnerRemain.forEach(p => {
        const safeName = sanitize(p.name);
        const key = `modal-partner-${safeName}`;
        const wrapper = document.createElement('label');
        wrapper.className = 'checkbox-wrapper';
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'additional-partner';
        checkbox.value = p.name;
        checkbox.dataset.key = key;
        checkbox.onchange = () => togglePartnerMatrix(checkbox, key);
        const span = document.createElement('span');
        span.textContent = p.name;
        wrapper.appendChild(checkbox);
        wrapper.appendChild(span);
        partnerContainer.appendChild(wrapper);
        const usedRoles = usedRoleMap.get(p.name) || new Set();
        const matrix = createPartnerRoleMatrix(key, usedRoles);
        matrix.style.display = 'none';
        partnerContainer.appendChild(matrix);
      });
    }

    console.groupEnd();
  }


  // ------------------------------------------
  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®ã€Œå†é€ä¿¡ï¼ˆæ›´æ–°ï¼‰ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ï¼š
  // å…¥åŠ›æ¤œè¨¼â†’formDataçµ„ã¿ç«‹ã¦â†’ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã¸
  // ------------------------------------------
  let pendingEditPayload = null;
  let formData = window.formData || {};  // å¿µã®ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«



  // ------------------------------------------
  // createCheckboxBlock: è¿½åŠ å…¥åŠ›ç”¨ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‹ä»˜éšUIã‚’ä½œæˆã™ã‚‹
  // ------------------------------------------

  function createCheckboxBlock(type, name, container) {
    const safeName = sanitize(name);
    const key = `modal-${type}-${safeName}`;

    console.log(`å€™è£œã‚’æç”»: ç¨®åˆ¥=${type === 'partner' ? 'å”åŠ›ä¼šç¤¾' : 'ä½œæ¥­è€…'} / åç§°=${name} / key=${key}`);

    const wrapper = document.createElement('label');
    wrapper.className = 'checkbox-wrapper';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = `additional-${type}`;
    checkbox.value = name;
    checkbox.dataset.key = key;

    // ãƒã‚§ãƒƒã‚¯æ™‚ã®æŒ™å‹•
    if (type === 'partner') {
      checkbox.onchange = () => togglePartnerMatrix(checkbox, key);
    } else {
      checkbox.onchange = () => toggleTimeInputs(checkbox, key);
    }

    const span = document.createElement('span');
    span.textContent = name;

    wrapper.appendChild(checkbox);
    wrapper.appendChild(span);
    container.appendChild(wrapper);

    if (type === 'partner') {
      const matrix = createPartnerRoleMatrix(key);
      matrix.style.display = 'none';
      container.appendChild(matrix);
    } else {
      const inputs = createTimeInputs(key);
      container.appendChild(inputs);
    }
  }



  // ------------------------------------------
  // ãã‚Œãã‚Œã®ã‚¯ãƒªãƒƒã‚¯ã«åˆã‚ã›ã¦æå†™
  // ------------------------------------------

  // â–¶ ä½œæ¥­è€…ã‚¯ãƒªãƒƒã‚¯æ™‚
  function handleToggleWorkerSection() {
    toggleSection('workerSection'); // é–‹é–‰ãƒˆã‚°ãƒ«

    const workerContainer = document.getElementById('additionalWorkerInputs');
    const alreadyRendered = workerContainer.childElementCount > 0;

    if (!alreadyRendered) {
      console.log('ğŸ§© ä½œæ¥­è€…ãƒªã‚¹ãƒˆã‚’åˆå›æç”»');
      renderAdditionalInputs('worker'); // â† ç¨®åˆ¥æŒ‡å®šã—ã¦å‘¼ã³å‡ºã™
    } else {
      console.log('âœ… ä½œæ¥­è€…ãƒªã‚¹ãƒˆã¯ã™ã§ã«æç”»æ¸ˆã¿');
    }
  }


  // ------------------------------------------
  // ãã‚Œãã‚Œã®ã‚¯ãƒªãƒƒã‚¯ã«åˆã‚ã›ã¦æå†™
  // ------------------------------------------

  // â–¶ å”åŠ›ä¼šç¤¾ã‚¯ãƒªãƒƒã‚¯æ™‚
  function handleTogglePartnerSection() {
    toggleSection('partnerSection'); // é–‹é–‰ãƒˆã‚°ãƒ«

    const partnerContainer = document.getElementById('additionalPartnerInputs');
    const alreadyRendered = partnerContainer.childElementCount > 0;

    if (!alreadyRendered) {
      console.log('ğŸ§© å”åŠ›ä¼šç¤¾ãƒªã‚¹ãƒˆã‚’åˆå›æç”»');
      renderAdditionalInputs('partner');
    } else {
      console.log('âœ… å”åŠ›ä¼šç¤¾ãƒªã‚¹ãƒˆã¯ã™ã§ã«æç”»æ¸ˆã¿');
    }
  }


  // ------------------------------------------
  // showEditConfirmationModal: ç·¨é›†å†…å®¹ã‚’ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã«çµ„ã¿ç«‹ã¦ã‚‹
  // ------------------------------------------
  function showEditConfirmationModal() {
    isEditMode = true;
    console.log('[showEditConfirmationModal] é–‹å§‹'); // å‡¦ç†é–‹å§‹ãƒ­ã‚°

    // æ—¢å­˜ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼ã‚¯ãƒªã‚¢å‡¦ç†ã¯ã“ã®å‰ã«ã‚ã‚‹å‰æ


    // --- 1) æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«è¡Œï¼‰ã®åé›† ---
    const records = [];

    // æ—¢å­˜è¡Œ
    (window.lastFetchedRecords || []).forEach((r, i) => {
      const man = parseFloat(document.getElementById(`edit-man-${i}`)?.value || 0);
      const ot = parseFloat(document.getElementById(`edit-overtime-${i}`)?.value || 0);

      let role = undefined; // ä½œæ¥­è€…ã¯ role ä¸è¦
      if (r.type === 'å”åŠ›ä¼šç¤¾') {
        const safe = sanitize(r.name);
        const sel = document.querySelector(`input[name="edit-partner-${safe}-role"]:checked`);
        role = sel ? sel.value : 'only'; // only | leader | other
      }

      records.push({ type: r.type, name: r.name, role, man, overtime: ot });
    });

    // è¿½åŠ ã®å”åŠ›ä¼šç¤¾ï¼ˆãƒãƒˆãƒªã‚¯ã‚¹æ§‹é€ å¯¾å¿œï¼‰
    document.querySelectorAll('.additional-partner:checked').forEach(cb => {
      const name = cb.value;
      const safe = sanitize(name);
      const key = `modal-partner-${safe}`;

      // å½¹å‰²ã”ã¨ã« check ã•ã‚Œã¦ã„ã‚‹è¡Œã ã‘ records ã«è¿½åŠ 
      const roles = [
        { key: 'general', value: 'only' }, // ä¸€èˆ¬ä½œæ¥­å“¡
        { key: 'leader', value: 'leader' }, // è·é•·
        { key: 'qualified', value: 'other' }  // æœ‰è³‡æ ¼è€…
      ];

      roles.forEach(({ key: rkey, value: rvalue }) => {
        const chk = document.querySelector(`input[name="${key}-${rkey}-checked"]`);
        if (!chk || !chk.checked) return;

        const man = parseFloat(document.querySelector(`input[name="${key}-${rkey}-man"]`)?.value || 0);
        const ot = parseFloat(document.querySelector(`input[name="${key}-${rkey}-overtime"]`)?.value || 0);

        records.push({
          type: 'å”åŠ›ä¼šç¤¾',
          name,
          role: rvalue,         // 'only' | 'leader' | 'other'
          man,
          overtime: ot
        });
      });
    });

    const meta = {
      date: document.getElementById('modalHistoryDate').value,
      companyId: document.getElementById('company').value,
      staffId: document.getElementById('staff').value,
      siteId: document.getElementById('site').value,
    };

    // â˜…ã“ã“ã§é€€é¿ï¼ˆsubmitEditFromModal ã¯ã“ã‚Œã‚’ãã®ã¾ã¾é€ã‚‹ï¼‰
    pendingEditPayload = { meta, records };   // â† ä¿å­˜ç”¨ã¯ã‚³ãƒ¬ã‚’ä½¿ã†

    // ---- ã“ã“ã‹ã‚‰ã€Œè¡¨ç¤ºç”¨ã€formData ã‚’ä½œã‚‹ ----
    const roleSuffixMap = {
      only: '',            // å”åŠ›ä¼šç¤¾ã®ã¿ â†’ ä¼šç¤¾åã ã‘
      leader: ' è·é•·',      // ãƒ•ãƒ«å¹…ã®ï¼‹ï¼ˆåŠè§’+ã§ã‚‚OKï¼‰
      other: ' æœ‰è³‡æ ¼è€…'
    };

    const workersDisp = records
      .filter(r => r.type === 'ä½œæ¥­è€…')
      .map(({ name, man, overtime }) => ({ name, man, overtime }));

    const partnersDisp = records
      .filter(r => r.type === 'å”åŠ›ä¼šç¤¾')
      .map(({ name, role, man, overtime }) => {
        const suffix = roleSuffixMap[role] ?? '';
        return { name: name + suffix, man, overtime };   // â† ä¼šç¤¾åã®å¾Œã‚ã«ã ã‘å½¹å‰²ã‚’ä»˜ã‘ã‚‹
      });

    // showConfirmation ãŒå‚ç…§ã™ã‚‹å½¢ã«æƒãˆã‚‹
    formData = {
      companyId: meta.companyId,
      staffId: meta.staffId,
      site: meta.siteId,
      date: meta.date,
      workers: workersDisp,
      partners: partnersDisp
    };
    console.log('[showEditConfirmationModal] formData for modal =',
      JSON.parse(JSON.stringify(formData)));

    console.log('[showEditConfirmationModal] æœ€çµ‚çµ„ã¿ç«‹ã¦', { meta, recordsä»¶æ•°: records.length });
    showConfirmation(true);
    console.log('[showEditConfirmationModal] çµ‚äº†'); // å‡¦ç†çµ‚äº†ãƒ­ã‚°
  }


  // ------------------------------------------
  // getPartnerCompanyMasterData: å”åŠ›ä¼šç¤¾ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
  // ------------------------------------------
  function getPartnerCompanyMasterData() {
    // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèª
    if (!window.masterData || !Array.isArray(masterData.partner)) {
      console.warn('masterData.partner ãŒæœªåˆæœŸåŒ–ã§ã™');
      return [];
    }
    const sample = masterData.partner.slice(0, 3); // å…ˆé ­3ä»¶ã ã‘
    console.info('masterData.partner ä»¶æ•°:', masterData.partner.length);
    console.log('masterData.partner å…ˆé ­3ä»¶ã‚µãƒ³ãƒ—ãƒ«:', sample);
    console.table(sample); // è¡¨å½¢å¼ã§ã‚‚ç¢ºèª
    return masterData.partner;
  }

  // -------------------------------------------------------------------------------

  // å½¹å‰²ã®å®šæ•°
  // ä¾‹: "BULLPOWERS è·é•·" â†’ { base:"BULLPOWERS", role:"leader" }
  //     "BULLPOWERS"     â†’ { base:"BULLPOWERS", role:"general" }



  // ------------------------------------------
  // parsePartnerDisplay: å”åŠ›ä¼šç¤¾ã®è¡¨ç¤ºåã‹ã‚‰åŸºåº•åã¨å½¹å‰²ã‚’æŠ½å‡ºã™ã‚‹
  // ------------------------------------------
  function parsePartnerDisplay(displayName) {
    const s = (displayName || '').trim();
    // æœ«å°¾ã® [ä»»æ„å€‹ã®ç©ºç™½(åŠè§’/å…¨è§’)] + (è·é•·|æœ‰è³‡æ ¼è€…) ã‚’å¸å
    // \u3000 ã¯å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
    const m = s.match(/[\s\u3000]*(è·é•·|æœ‰è³‡æ ¼è€…)\s*$/);
    if (m) {
      const base = s.slice(0, s.length - m[0].length).trim();
      const role = m[1] === 'è·é•·' ? ROLE.LEADER : ROLE.QUALIFIED;
      return { base, role };
    }
    return { base: s, role: ROLE.GENERAL };
  }

  // Map<ä¼šç¤¾å, Set<role>>



  // ------------------------------------------
  // buildUsedPartnerRoleMap: ä½¿ç”¨æ¸ˆã¿å½¹å‰²ã‚’ä¼šç¤¾å˜ä½ã§é›†è¨ˆã™ã‚‹
  // ------------------------------------------
  function buildUsedPartnerRoleMap() {
    const used = new Map();

    // â‘  ã‚µãƒ¼ãƒã‹ã‚‰å–ã£ã¦ã‚ã‚‹å½“æ—¥ãƒ¬ã‚³ãƒ¼ãƒ‰
    (window.lastFetchedRecords || []).forEach(r => {
      if (r.type !== 'å”åŠ›ä¼šç¤¾') return;
      // r.name ã¯ã€ŒBULLPOWERSã€ã€ŒBULLPOWERS è·é•·ã€â€¦ã®ã©ã‚Œã‹
      const { base, role } = parsePartnerDisplay(r.name);
      if (!used.has(base)) used.set(base, new Set());
      used.get(base).add(role || ROLE.GENERAL);
    });

    // â‘¡ ç”»é¢ã®ç·¨é›†ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œï¼ˆã¾ã é€ä¿¡ã—ã¦ã„ãªã„ãŒç·¨é›†ä¸­ã®ã‚‚ã®ã‚‚é™¤å¤–ï¼‰
    document.querySelectorAll('#edit-table tbody tr').forEach(row => {
      const type = row.querySelector('td:nth-child(1)')?.textContent.trim();
      if (type !== 'å”åŠ›ä¼šç¤¾') return;
      const dispName = row.querySelector('td:nth-child(2)')?.textContent.trim() || '';
      const { base, role } = parsePartnerDisplay(dispName);
      if (!used.has(base)) used.set(base, new Set());
      used.get(base).add(role || ROLE.GENERAL);
    });
    console.log('[usedRoleMap]', Array.from(used.entries()).map(
      ([name, set]) => [name, Array.from(set)]
    ));
    return used;
  }




  // ------------------------------------------
  // createPartnerRoleMatrix: å”åŠ›ä¼šç¤¾å‘ã‘å½¹å‰²å…¥åŠ›ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ç”Ÿæˆã™ã‚‹
  // ------------------------------------------
  function createPartnerRoleMatrix(nameKey, usedRoles = new Set()) {
    const wrap = document.createElement('div');
    wrap.className = 'partner-role-matrix';
    wrap.id = `matrix-${nameKey}`;
    wrap.style.display = 'none';

    wrap.innerHTML = `
    <div class="role-row" data-role="general">
      <label><input type="checkbox" name="${nameKey}-general-checked"> ä¸€èˆ¬ä½œæ¥­å“¡</label>
      <input type="number" step="0.25" min="0" placeholder="äººå·¥" name="${nameKey}-general-man">
      <input type="number" step="0.25" min="0" placeholder="æ®‹æ¥­" name="${nameKey}-general-overtime">
    </div>
    <div class="role-row" data-role="leader">
      <label><input type="checkbox" name="${nameKey}-leader-checked"> è·é•·</label>
      <input type="number" step="0.25" min="0" placeholder="äººå·¥" name="${nameKey}-leader-man">
      <input type="number" step="0.25" min="0" placeholder="æ®‹æ¥­" name="${nameKey}-leader-overtime">
    </div>
    <div class="role-row" data-role="qualified">
      <label><input type="checkbox" name="${nameKey}-qualified-checked"> æœ‰è³‡æ ¼è€…</label>
      <input type="number" step="0.25" min="0" placeholder="äººå·¥" name="${nameKey}-qualified-man">
      <input type="number" step="0.25" min="0" placeholder="æ®‹æ¥­" name="${nameKey}-qualified-overtime">
    </div>
  `;

    // ä½¿ç”¨æ¸ˆã¿ã®å½¹å‰²ã¯è¡Œã”ã¨é™¤å»ï¼ˆ= å…¥åŠ›UIã‚’ç”Ÿæˆã—ãªã„ï¼‰
    ['general', 'leader', 'qualified'].forEach(role => {
      if (usedRoles.has(role)) {
        const row = wrap.querySelector(`.role-row[data-role="${role}"]`);
        if (row) row.remove();
      }
    });

    return wrap;
  }

  window.openHistoryModal = openHistoryModal;
  window.closeHistoryModal = closeHistoryModal;
  window.loadPreviousRecords = loadPreviousRecords;
  window.loadModalHistory = loadModalHistory;
  window.showEditFormInModal = showEditFormInModal;
  window.renderAdditionalInputs = renderAdditionalInputs;
  window.showEditConfirmationModal = showEditConfirmationModal;
  window.submitEditFromModal = submitEditFromModal;

</script>









<style>
/* ========= å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ« ========= */
  #historyModal {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0, 0, 0, .5);
    display: none;
    /* JSã§flexã«åˆ‡ã‚Šæ›¿ãˆ */
    justify-content: center;
    align-items: center;
    padding: 24px;
    box-sizing: border-box;
  }

  #historyModal .modal-body {
    width: min(92vw, 720px);
    max-height: 90vh;
    overflow: auto;
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-sizing: border-box;
  }

  #historyModal .modal-body button {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }

  /* ========= ãƒ†ãƒ¼ãƒ–ãƒ« ========= */
  #historyModal table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid #ccc;
  }

  #historyModal th {
    background: #f0f8ff;
    font-weight: bold;
    font-size: 1.4rem;
    padding: .75rem;
    text-align: center;
    border: 1px solid #ccc;
  }

  #historyModal td {
    padding: .6rem;
    text-align: center;
    border: 1px solid #ddd;
    font-size: 1.3rem;
  }

  #historyModal tr:nth-child(even) {
    background: #f9f9f9;
  }


  /* --- ç·¨é›†ãƒ†ãƒ¼ãƒ–ãƒ«ã®å½¹å‰²åˆ—ã‚’ã¯ã¿å‡ºã•ã›ãªã„ --- */
  #edit-table th:nth-child(3),
  #edit-table td:nth-child(3) {
    width: 260px;
    /* â† æ¨ªå¹…ã‚’ã—ã£ã‹ã‚Šç¢ºä¿ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¢—æ¸›ï¼‰ */
    max-width: 260px;
    vertical-align: top;
  }

  /* ã‚»ãƒ«å†…ã®æ–‡å­—ãŒ1æ–‡å­—ã”ã¨ã«æŠ˜ã‚Šè¿”ã•ã‚Œãªã„ã‚ˆã†ã« */
  #edit-table .role-cell {
    white-space: normal;
    /* æ¨ªå¹…ã«å¿œã˜ã¦è‡ªç„¶ã«æŠ˜è¿”ã— */
    line-height: 1.3;
  }


  .checkbox-wrapper {
    display: flex;
    align-items: center;
    gap: .75rem;
    padding: .75rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: #fff;
    cursor: pointer;
    font-size: 3.25rem;
  }

  .checkbox-wrapper span {
    font-size: 3.25rem;
    font-weight: normal;
    white-space: nowrap;
  }

  .checkbox-wrapper input[type="checkbox"]:checked+span {
    color: #0066cc;
    font-size: 3.25rem;
    font-weight: normal;
    font-family: 'Noto Sans JP', sans-serif;
    white-space: nowrap;
  }


  .partner-role-wrap {
    margin: 12px 0 6px;
  }

   /* å½¹å‰²ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼š2åˆ—ä¸¦ã³ + è‡ªå‹•æŠ˜è¿”ã— */
  .partner-role-grid {
    display: grid;
    grid-template-columns: 1fr;
    /* â† ç¸¦1åˆ— */
    gap: 8px;
  }

  .role-card input[type="radio"] {
    flex: 0 0 auto;
  }

  /* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³è¡Œå…¨ä½“ */
.role-card {
  display: flex;
  align-items: center;        /* ç¸¦æ–¹å‘ã®ä¸­å¤®å¯„ã› */
  justify-content: center;    /* æ¨ªæ–¹å‘ã®ä¸­å¤®å¯„ã› */
  gap: 10px;                  /* ãƒœã‚¿ãƒ³ã¨æ–‡å­—ã®é–“ */
  padding: 16px;
  border: 1px solid #ccc;
  border-radius: 10px;
  background: #fff;
  cursor: pointer;
  width: 100%;
  box-sizing: border-box;
}

/* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
.role-card input[type="radio"] {
  width: 20px;
  height: 20px;
}

/* ãƒ©ãƒ™ãƒ«æ–‡å­— */
.role-card span {
  font-size: 1.35rem;   /* â† 2remã®ç´„2/3ã‚µã‚¤ã‚º */
  font-weight: bold;
  text-align: center;
}

/* * æ•°å€¤å…¥åŠ›ãŒå¤§ãã™ãã¦åˆ—ã‚’æŠ¼ã—åºƒã’ãªã„ã‚ˆã†ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§æŠ‘ãˆã‚‹ */ */
  #historyModal .work-input {
    width: 120px;
    max-width: 100%;
    font-size: 18px;
    padding: 8px 10px;
  }

/* ç”»é¢ãŒç‹­ã„æ™‚ã¯å½¹å‰²ã‚«ãƒ¼ãƒ‰ã‚’1åˆ—ã«ã—ã¦ç¸¦ã«ä¸¦ã¹ã‚‹ */
@media (max-width: 520px) {
  .partner-role-grid {
    grid-template-columns: 1fr;
  }

  #edit-table th:nth-child(3),
  #edit-table td:nth-child(3) {
    width: 100%;
    max-width: none;
  }
}


/* äººå·¥ãƒ»æ®‹æ¥­ã®å…¥åŠ›æ¬„ï¼šå‡ç­‰å¹…ã§åºƒã’ã‚‹ï¼ˆå°ã•ã‚ãƒ•ã‚©ãƒ³ãƒˆã«ä¸Šæ›¸ãï¼‰ */
.role-row .work-inputs input[type="number"] {
  flex: 1;
  /* â† å‡ç­‰å¹… */
  width: auto;
  /* ä»¥å‰ã® width:100px ã‚’æ‰“ã¡æ¶ˆã— */
  font-size: 2rem;
  /* â† å…¥åŠ›æ–‡å­—ã¯å°‘ã—å°ã•ã‚ï¼ˆå…¨ä½“4remã‚ˆã‚Šç¸®å°ï¼‰ */
  padding: 1.2rem 1.4rem;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-sizing: border-box;
}


#confirmationBox,
#confirmationModal.modal--success #confirmationBox,
#historyModal .modal-body {
  width: 96vw !important;
  /* æ¨ªå¹…ã‚’ç”»é¢ã®96% */
  height: 92vh !important;
  /* ç¸¦å¹…ã‚’ç”»é¢ã®92% */
  max-width: none !important;
  max-height: none !important;
  overflow: auto !important;
  /* å†…å®¹ãŒé•·ã„ã¨ãã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
  border-radius: 12px;
  padding: 20px 24px;
  box-shadow: 0 6px 24px rgba(0, 0, 0, .25);
}

</style>
